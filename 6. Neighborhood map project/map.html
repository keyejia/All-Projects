<!DOCTYPE html>
<html>
  <head>
    <title>Neighborhood of Home</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var cities = [{
        name:'Xian',
        coord: {lat: 34.3483581, lng: 108.9218753}
      },
      {
        name:'SuZhou',
        coord: {lat:31.3003358,lng:120.5759451}
      },
      {
        name:'Shanghai',
        coord: {lat:31.230	,lng:121.470}
      },
      {
        name:'Beijing',
        coord: {lat:39.930,lng:116.400}
      },
      {
        name:'Wuhan',
        coord: {lat:30.580,lng:114.270}
      },
      {
        name:'Chengdu',
        coord: {lat:30.670,lng:104.070}
      },
      {
        name:'Harbin',
        coord: {lat:45.750,lng:126.650}
      },
      {
        name:'Nanjing',
        coord: {lat:32.050,lng:118.780}
      },
      {
        name:'Jinan',
        coord: {lat:36.670,lng:117.000}
      },
      {
        name:'Shenyang',
        coord: {lat:41.800,lng:123.450}
      },
      {
        name:'zhuhai',
        coord: {lat:22.210928,lng:113.552971}
      },
      {
        name:'Kunming',
        coord: {lat:24.8801,lng:102.8329}
      },
      {
        name:'Guilin',
        coord: {lat:25.2345,lng:110.1800}
      }
      ];

      var markers = [];

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 39.7970062, lng: 109.653086},
          zoom: 5
        });

        var Icon = {
          url:'img/yellow_star.png',
          size: new google.maps.Size(32,32),
          origin: new google.maps.Point(0,0),
          anchor: new google.maps.Point(16, 16)
        };

        infoWindow = new google.maps.InfoWindow();

        cities.forEach(function(cities){
          cities.marker = new google.maps.Marker({
            position: cities.coord,
            icon: Icon,
            map: map,
            animation: google.maps.Animation.DROP,
            title: cities.name
          });

          google.maps.event.addListener(cities.marker, 'click', function() {
				WikiInfoWindow(cities);
				toggleBounce(cities.marker);
		  });

          markers.push({
            name: cities.name,
            marker: cities.marker
          });

        });
      }

      function WikiInfoWindow(cities){
      	
      	var extract ='';
      	var imagesurl='';

      	var wikiUrl = 'https://en.wikipedia.org/w/api.php?'+
      					'action=query'+
      					'&format=json'+
      					'&prop=images'+
      					'%7Cextracts'+
      					'&list='+
      					'&meta='+
      					'&titles='+cities.name+
      					'&imlimit=10'+
      					'&exintro=1';
      	$.ajax({
    		url: wikiUrl,
    		data: {
       				 format: 'json'
    			  },
    		dataType: 'jsonp'
		}).done( function ( data ){
      			var pages = data.query.pages;
      			var imagesurl = '';
      			
      			for (var id in pages){
      				var extract = pages[id].extract;
      				var images = pages[id].images;
      			};

      			/*var imagesurl = JSON.stringify(images);*/
/*      			for (i = 0; i<images.length; i++){


      				var imagesurl = imagesurl + '<img src="https://en.wikipedia.org/wiki/' +
      							cities.name + '#/media/' +
      							images[i].title.replace(/ /g, "_") + '">';
      			}*/
      			/*images.forEach(function(image){
      				var imagesurl = '<img src="https://en.wikipedia.org/wiki/' +
      							cities.name + '#media/'
      							JSON.stringify(image.title) + '">';
      			});*/

AIzaSyAYefe2-La9-z19dvuXvN12koK4rPzPjJo

      		});
		.ajax({
			url:'https://api.cognitive.microsoft.com/bing/v7.0/images/search?q=' + 
			     encodeURIComponent(cities.name) +
			     '&mkt=en-us';
			Ocp-Apim-Subscription-Key: '666';

		}).done(function(data){

		});
		var contentString = '<div><h3>' +
      						cities.name + '</h3>' +
      						extract + 
      						imagesurl+
      						'</div>';

      	infoWindow.setContent(contentString);
		infoWindow.open(map, cities.marker);
      }
      

      function toggleBounce(marker) {
        if (marker.getAnimation() !== null) {
          marker.setAnimation(null);
        } else {
          marker.setAnimation(google.maps.Animation.BOUNCE);
          setTimeout(function() {
			marker.setAnimation(null);
		}, 700);
        }
      }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb-pmLEU0VC1b2Cbzi1w-nxEzY2oN8WEU&callback=initMap"
    async defer></script>
  </body>
</html>